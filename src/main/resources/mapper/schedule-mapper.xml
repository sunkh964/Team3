<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 해당 파일에 모든 쿼리문을 작성 -->
<mapper namespace="scheduleMapper">
    <resultMap id="schedule" type="com.green.Team3.schedule.vo.ScheduleVO">
        <id column="SCH_NUM" property="schNum"/>
        <result column="START" property="start"/>
        <result column="END" property="end"/>
        <result column="TITLE" property="title"/>
        <result column="COLOR" property="color"/>
        <result column="DESCRIPTION" property="description"/>
        <result column="ALL_DAY" property="allDay"/>
        <association property="staffVO" resultMap="staffMapper.staff" />
    </resultMap>

<!--    <resultMap id="event" type="com.green.Team3.schedule.vo.EventVO">-->
<!--        <id column="SCH_NUM" property="schNum"/>-->
<!--        <result column="TITLE" property="title"/>-->
<!--        <result column="DATE" property="date"/>-->
<!--    </resultMap>-->

     <!-- 직원 전체의 일정 목록 조회 -->
    <select id="getAllList" resultMap="schedule">
        SELECT
            SCH_NUM
            , SCH_TITLE TITLE
            , SCH_CONTENT DESCRIPTION
            , SCH.STAFF_NUM
            , CASE
                WHEN ALL_DAY = 'Y' THEN DATE_FORMAT(SCH_SDATE, '%Y-%m-%d')
                ELSE DATE_FORMAT(SCH_SDATE, '%Y-%m-%d %H:%i:%s')
                END AS START
            , CASE
                WHEN ALL_DAY = 'Y' THEN DATE_FORMAT(SCH_EDATE, '%Y-%m-%d')
                ELSE DATE_FORMAT(SCH_EDATE, '%Y-%m-%d %H:%i:%s')
                END AS END
            , COLOR
            , ALL_DAY
        FROM HOS_SCHEDULE SCH, HOS_STAFF S
        WHERE SCH.STAFF_NUM = S.STAFF_NUM
    </select>

    <!-- 직원 한 명의 일정 목록 조회 -->
    <select id="getOneList" resultMap="schedule">
        SELECT
            SCH_NUM
            , SCH_TITLE TITLE
            , SCH_CONTENT DESCRIPTION
            , SCH.STAFF_NUM
            , CASE
                WHEN ALL_DAY = 'Y' THEN DATE_FORMAT(SCH_SDATE, '%Y-%m-%d')
                ELSE DATE_FORMAT(SCH_SDATE, '%Y-%m-%d %H:%i:%s')
                END AS START
            , CASE
                WHEN ALL_DAY = 'Y' THEN DATE_FORMAT(SCH_EDATE, '%Y-%m-%d')
                ELSE DATE_FORMAT(SCH_EDATE, '%Y-%m-%d %H:%i:%s')
                END AS END
            , COLOR
            , ALL_DAY
            FROM HOS_SCHEDULE SCH, HOS_STAFF S
            WHERE SCH.STAFF_NUM = S.STAFF_NUM
            AND SCH.STAFF_NUM = #{staffNum}
    </select>

    <!-- 직원 한 명의 일정 상세 조회 -->
    <select id="getDetail" resultMap="schedule">
        SELECT
            SCH_NUM
            , SCH_TITLE TITLE
            , SCH_CONTENT DESCRIPTION
            , SCH.STAFF_NUM
            , CASE
                WHEN ALL_DAY = 'Y' THEN DATE_FORMAT(SCH_SDATE, '%Y-%m-%d')
                ELSE DATE_FORMAT(SCH_SDATE, '%Y-%m-%d %H:%i')
                END AS START
            , CASE
                WHEN ALL_DAY = 'Y' THEN DATE_FORMAT(SCH_EDATE, '%Y-%m-%d')
                ELSE DATE_FORMAT(SCH_EDATE, '%Y-%m-%d %H:%i')
                END AS END
            , COLOR
            , ALL_DAY
        FROM HOS_SCHEDULE SCH, HOS_STAFF S
        WHERE SCH.STAFF_NUM = S.STAFF_NUM
            AND SCH_NUM = #{schNum}
    </select>

    <!-- 일정 추가 -->
    <insert id="addEvent">
        INSERT INTO HOS_SCHEDULE (
            SCH_TITLE
            , SCH_CONTENT
            , STAFF_NUM
            , COLOR
            , SCH_SDATE
            , SCH_EDATE
            , ALL_DAY
        ) VALUES (
            #{title}
            , #{description}
            , #{staffNum}
            , #{color}
            <if test='allDay = true'>
                , DATE_FORMAT(#{start}, '%Y-%m-%d')
                , DATE_FORMAT(#{end}, '%Y-%m-%d')
                , 'Y'
            </if>
            <if test='allDay = false'>
                , #{start}
                , #{end}
                ,'N'
            </if>
        );
    </insert>

    <!-- 일정 삭제 -->
    <delete id="deleteEvent">
        DELETE FROM HOS_SCHEDULE
        WHERE SCH_NUM = #{schNum}
    </delete>

    <!-- 일정 수정 -->
    <update id="modifyEvent">
        UPDATE hos_schedule SET
            SCH_TITLE = #{title}
            , SCH_CONTENT = #{description}
            , COLOR = #{color}
            , SCH_SDATE = #{start}
            , SCH_EDATE = #{end}
            , ALL_DAY
        WHERE SCH_NUM = #{schNum};
    </update>

</mapper>
