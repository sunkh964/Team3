<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 해당 파일에 모든 쿼리문을 작성 -->
<mapper namespace="orderItemMapper">
    <resultMap id="orderItem" type="com.green.Team3.orderItem.vo.OrderItemVO">
        <id column="ORDER_NUM" property="orderNum"/>
        <result column="ORDER_CNT" property="orderCnt"/>
        <result column="ORDER_DATE" property="orderDate"/>
        <result column="DEPART_TIME" property="departTime"/>
        <result column="ARRIVE_TIME" property="arriveTime"/>
        <association property="supVO" resultMap="supMapper.sup"/>
        <association property="itemTypeVO" resultMap="supMapper.itemType"/>
        <association property="itemVO" resultMap="supMapper.item"/>
        <association property="deliverVO" resultMap="deliver"/>
    </resultMap>

    <resultMap id="orderAmount" type="com.green.Team3.orderItem.vo.OrderAmountVO">
        <result column="TYPE_NAME" property="typeName"/>
        <result column="TOTAL_AMOUNT" property="totalAmount"/>
    </resultMap>

    <resultMap id="deliver" type="com.green.Team3.orderItem.vo.DeliverVO">
        <result column="DELI_NUM" property="deliNum"/>
        <result column="DELI_STATUS" property="deliStatus"/>
    </resultMap>

    <!-- 구입항목 가져오기 -->
    <select id="selectOrderItem" resultMap="orderItem">
        SELECT * FROM ORDER_ITEM O, SUP S, ITEM_TYPE T, ITEM SP, DELIVER D
        WHERE O.ITEM_NUM = SP.ITEM_NUM
        AND SP.SUP_NUM= S.SUP_NUM
        AND SP.TYPE_NUM = T.TYPE_NUM
<!--        AND MONTH(I.ORDER_DATE) = MONTH(CURRENT_DATE())-->
<!--        AND YEAR(I.ORDER_DATE) = YEAR(CURRENT_DATE())-->
        <if test='searchValue != null and !searchValue.equals("")'>
            AND ${searchType} LIKE CONCAT('%', #{searchValue}, '%')
        </if>
        ORDER BY O.ORDER_DATE DESC;
    </select>

    <!-- 상품 타입별 총 금액 -->
    <select id="totalOrderAmount" resultMap="orderAmount">
        SELECT T.TYPE_NAME, SUM(I.ORDER_CNT * P.PRICE) AS TOTAL_AMOUNT
        FROM ORDER_ITEM I, ITEM_TYPE T, ITEM P
        WHERE I.ITEM_NUM = P.ITEM_NUM
        AND T.TYPE_NUM = P.TYPE_NUM
<!--        AND MONTH(I.ORDER_DATE) = MONTH(CURRENT_DATE())-->
<!--        AND YEAR(I.ORDER_DATE) = YEAR(CURRENT_DATE())-->
        GROUP BY T.TYPE_NAME
        ORDER BY T.TYPE_NAME;

    </select>



</mapper>
